<!--
FLOCKING ON GOOGLE MAPS
   Cody Smith. feb 2010

this is a flocking model put inside of a kml rectangle on google maps version 3.
All of the default values are stored in simulator2.js

keys:
p     put down an attractor,president mode
b     bomb mode
s     shooter mode
w     remove walls
o     stop viewing circles around attracors
x     start/stop
r     reset

-->


<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<title>flocking on google maps v3</title>
<link href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="js_ajax.js"></script>
<script src="overlay.js"></script>
<script src='fetchXML.js'></script>
<script src="boids2.js"></script>
<script src="simulator2.js"></script>
<script type="text/javascript">
    
ajax(0);//get the kml file
var sim = null;
xml_done = function( ){ 

 
    fetchMain() 
    initialize();
    sim = new simulator();
    
    patches = new patchArray(100,100);
    sim.attachBoundry( patches);
    
    sim.startSim();
    
 


};

var overlay;
var ctx;
var bb;
var uiMode = { key:'president' }; //attractor is 'bomb' or 'president' or 'shooter'

function initialize() {
    bb = boundingBox( polygons[0] );
    
    var myLatLng = new google.maps.LatLng( bb.y, bb.x);
    var myOptions = {
	zoom: 18,
	center: myLatLng,
	mapTypeId: google.maps.MapTypeId.SATELLITE
    };



    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    
    var swBound = new google.maps.LatLng(bb.y  , bb.x  );
    var neBound = new google.maps.LatLng(bb.y + bb.width , bb.x + bb.width );
    var bounds = new google.maps.LatLngBounds(swBound, neBound);
    
    // Photograph courtesy of the U.S. Geological Survey
    var srcImage = 'http://www.safariegypt.com/egypt_nile_cruise/oberoiShehrayar/photos/OberoiSherayarSwimmingPool.jpg';
    overlay = new USGSOverlay(bounds, srcImage, map);


    var georssLayer = new google.maps.KmlLayer('http://www.m0ose.com/javascripts/airportboundry.kml');
    georssLayer.setMap(map);

   
}
var e2=0;
window.onkeypress = function( e){
    e2 = e;
    var ch = String.fromCharCode( e.charCode );
    ch = ch.toLowerCase();
    if( ch == 'b')//bomb mode
	uiMode.key = 'bomb';
    else if( ch == 'p')
	uiMode.key = 'president';
    else if( ch == 's')
	uiMode.key = 'shooter';
    else if( ch =='w'){//remove the walls
	if( sim)
	    sim._usingBoundry = !sim._usingBoundry;
    }
    else if( ch =='o' && sim)
	sim.drawAttractors = !sim.drawAttractors;
    else if( ch =='x' && sim){
	if(!sim.running){
	    sim.startSim();
	}
	else{
	    sim.stopSim();
	}
    }
    else if( ch =='r' )
    {
	xml_done();
    }

    

}
</script>
    </head>
<body>
  <div id="map_canvas"></div>
</body>
</html>
